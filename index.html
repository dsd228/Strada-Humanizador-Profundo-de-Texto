<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="RedactaPro Supremo: Humaniza textos de IA para evitar detectores académicos." />
  <title>RedactaPro Supremo - Evita Detectores de IA</title>
  <!-- Tailwind CSS vía CDN (válido para GitHub Pages) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'border-color': '#374151',
          },
        },
      },
    };
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .line-clamp-1 {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .animate-fade-in {
      animation: fade-in 0.3s ease-out;
    }
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .whitespace-pre-wrap {
      white-space: pre-wrap;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-100">
  <div id="app">
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-black/20 backdrop-blur-md border-b border-slate-700/50">
      <div class="container mx-auto px-4 py-4">
        <div class="flex flex-col sm:flex-row justify-between items-center">
          <h1 class="text-2xl font-bold bg-gradient-to-r from-teal-400 to-emerald-500 bg-clip-text text-transparent">
            RedactaPro Supremo
          </h1>
          <p class="text-sm text-slate-400 mt-1 sm:mt-0">
            Humaniza tu texto, evita detectores de IA
          </p>
        </div>
      </div>
    </header>

    <!-- Tabs -->
    <div class="container mx-auto px-4 pt-6">
      <div class="flex space-x-1 bg-slate-800/50 p-1 rounded-xl w-fit mb-6 backdrop-blur-sm">
        <button onclick="setActiveTab('write')" class="px-6 py-2 rounded-lg font-medium transition-all duration-200 capitalize tab-btn" id="tab-write">
          Editor
        </button>
        <button onclick="setActiveTab('analyze')" class="px-6 py-2 rounded-lg font-medium transition-all duration-200 capitalize tab-btn" id="tab-analyze">
          Análisis
        </button>
        <button onclick="setActiveTab('review')" class="px-6 py-2 rounded-lg font-medium transition-all duration-200 capitalize tab-btn" id="tab-review">
          Resultado
        </button>
      </div>
    </div>

    <main class="container mx-auto px-4 pb-8">
      <!-- Editor Tab -->
      <div id="write-section" class="grid lg:grid-cols-5 gap-8">
        <div class="lg:col-span-2 space-y-6">
          <div class="bg-white/10 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-xl">
            <h2 class="text-lg font-semibold mb-4 text-slate-100">Configuración</h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Profundidad</label>
                <select id="setting-depth" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                  <option value="suave">Suave</option>
                  <option value="moderado">Moderado</option>
                  <option value="profundo">Profundo</option>
                </select>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <label class="flex items-center space-x-2 text-sm">
                  <input type="checkbox" id="setting-naturalFlow" checked class="w-4 h-4 text-teal-500 rounded focus:ring-teal-500">
                  <span class="text-slate-300">Flujo natural</span>
                </label>
                <label class="flex items-center space-x-2 text-sm">
                  <input type="checkbox" id="setting-toneAdjustment" checked class="w-4 h-4 text-teal-500 rounded focus:ring-teal-500">
                  <span class="text-slate-300">Ajuste de tono</span>
                </label>
                <label class="flex items-center space-x-2 text-sm">
                  <input type="checkbox" id="setting-readabilityFocus" checked class="w-4 h-4 text-teal-500 rounded focus:ring-teal-500">
                  <span class="text-slate-300">Legibilidad</span>
                </label>
                <label class="flex items-center space-x-2 text-sm">
                  <input type="checkbox" id="setting-connectorVariety" checked class="w-4 h-4 text-teal-500 rounded focus:ring-teal-500">
                  <span class="text-slate-300">Conectores</span>
                </label>
                <label class="flex items-center space-x-2 text-sm">
                  <input type="checkbox" id="setting-lexicalRichness" checked class="w-4 h-4 text-teal-500 rounded focus:ring-teal-500">
                  <span class="text-slate-300">Riqueza léxica</span>
                </label>
                <label class="flex items-center space-x-2 text-sm">
                  <input type="checkbox" id="setting-avoidRepetition" checked class="w-4 h-4 text-teal-500 rounded focus:ring-teal-500">
                  <span class="text-slate-300">Evitar repetición</span>
                </label>
              </div>

              <label class="flex items-center space-x-2 text-sm">
                <input type="checkbox" id="setting-simulateHumanErrors" class="w-4 h-4 text-teal-500 rounded focus:ring-teal-500">
                <span class="text-slate-300">Simular errores humanos</span>
              </label>
            </div>
          </div>

          <div class="bg-white/10 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-semibold mb-4 text-slate-100">Historial</h3>
            <div id="history-container" class="space-y-2 max-h-60 overflow-y-auto">
              <p class="text-sm text-slate-400">No hay historial aún</p>
            </div>
          </div>
        </div>

        <div class="lg:col-span-3">
          <div class="bg-white/10 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-xl">
            <textarea id="input-text" placeholder="Pega tu texto aquí para humanizarlo..." class="w-full h-80 bg-transparent text-slate-100 placeholder-slate-400 resize-none outline-none"></textarea>
            <div class="flex flex-wrap gap-3 mt-4">
              <button id="process-btn" onclick="processText()" class="flex-1 bg-gradient-to-r from-teal-500 to-emerald-600 hover:from-teal-600 hover:to-emerald-700 disabled:from-slate-600 disabled:to-slate-700 text-white font-medium py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                Humanizar y Analizar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Analysis Tab -->
      <div id="analyze-section" class="hidden">
        <div class="grid lg:grid-cols-5 gap-8">
          <div class="lg:col-span-2">
            <div class="bg-white/10 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-xl h-full">
              <h2 class="text-xl font-semibold mb-6 text-slate-100">Progreso</h2>
              <div class="space-y-4">
                <div class="flex justify-between text-sm">
                  <span class="text-slate-300">Estado</span>
                  <span id="progress-message" class="text-teal-400 font-medium">Esperando...</span>
                </div>
                <div class="w-full bg-slate-700 rounded-full h-2">
                  <div id="progress-bar" class="bg-gradient-to-r from-teal-400 to-emerald-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div id="progress-percent" class="text-sm text-slate-400">0% completado</div>
              </div>
            </div>
          </div>

          <div class="lg:col-span-3">
            <div class="bg-white/10 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-xl">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-slate-100">Texto Procesado</h2>
                <button onclick="copyToClipboard()" class="text-sm bg-teal-500 hover:bg-teal-600 px-4 py-2 rounded-lg transition-colors">Copiar</button>
              </div>
              <div id="output-analysis" class="min-h-60 bg-slate-800/50 rounded-lg p-4 text-slate-100 whitespace-pre-wrap">
                El texto procesado aparecerá aquí...
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Review Tab -->
      <div id="review-section" class="hidden">
        <div class="grid lg:grid-cols-3 gap-8">
          <div class="lg:col-span-2">
            <div class="bg-white/10 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-xl">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-slate-100">Texto Final</h2>
                <div class="flex gap-2">
                  <button onclick="downloadText('txt')" class="text-sm bg-slate-600 hover:bg-slate-700 px-3 py-1 rounded">TXT</button>
                  <button onclick="downloadText('doc')" class="text-sm bg-slate-600 hover:bg-slate-700 px-3 py-1 rounded">DOC</button>
                </div>
              </div>
              <div id="output-review" class="bg-slate-800/50 rounded-lg p-4 h-96 overflow-y-auto text-slate-100 whitespace-pre-wrap">
                El texto final aparecerá aquí...
              </div>
            </div>
          </div>

          <div>
            <div class="bg-white/10 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-xl space-y-6">
              <div>
                <h3 class="text-lg font-semibold text-slate-100 mb-4">Análisis de Calidad</h3>
                <div class="bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-lg p-4 border border-orange-400/30">
                  <div class="flex justify-between text-sm text-slate-300 mb-2">
                    <span>Probabilidad de ser Humano</span>
                    <span id="analysis-score" class="font-bold text-yellow-300">0%</span>
                  </div>
                  <div class="w-full bg-slate-700 rounded-full h-2">
                    <div id="score-bar" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-2 rounded-full" style="width: 0%"></div>
                  </div>
                  <p id="score-message" class="mt-2 text-sm text-orange-200">Introduce texto para analizar.</p>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-800/40 p-4 rounded-lg">
                  <div id="word-count-original" class="text-2xl font-bold text-teal-400">0</div>
                  <div class="text-xs text-slate-400">Palabras Original</div>
                </div>
                <div class="bg-slate-800/40 p-4 rounded-lg">
                  <div id="word-count-final" class="text-2xl font-bold text-emerald-400">0</div>
                  <div class="text-xs text-slate-400">Palabras Final</div>
                </div>
                <div class="bg-slate-800/40 p-4 rounded-lg col-span-2">
                  <div id="readability-score" class="text-lg font-bold text-blue-400">0%</div>
                  <div class="text-xs text-slate-400">Legibilidad</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 right-4 bg-teal-500 text-white px-4 py-2 rounded-lg shadow-lg hidden animate-fade-in">
      ¡Texto copiado al portapapeles!
    </div>

    <footer class="py-6 border-t border-slate-700/50 mt-8 backdrop-blur-md">
      <div class="container mx-auto px-4 text-center text-sm text-slate-300">
        <p>RedactaPro Supremo © 2024. Procesamiento 100% local.</p>
      </div>
    </footer>
  </div>

  <script>
    // --- Estado de la aplicación ---
    const state = {
      inputText: '',
      outputText: '',
      isProcessing: false,
      analysisScore: 0,
      activeTab: 'write',
      history: [],
      progress: 0,
      progressMessage: 'Esperando...'
    };

    // --- Listas de reemplazo ---
    const connectors = [
      "Bueno,", "Mira,", "La verdad es que,", "O sea,", "Tipo,", "Vamos,", "Pues,",
      "Por otro lado,", "En contraste,", "De hecho,", "Asimismo,", "No obstante,",
      "Así pues,", "De ahí que,", "En fin,", "Para que te hagas una idea,",
      "A decir verdad,", "Entre tú y yo,", "Para serte sincero,", "Si te soy honesto,",
      "De cualquier modo,", "En cualquier caso,", "Eso sí,", "En última instancia,",
      "Por lo tanto,", "Ahora bien,", "Dicho esto,", "Hecho esto,",
    ];

    const humanIdioms = [
      "cuesta abajo", "pan comido", "ponerse las pilas", "dar en el clavo",
      "tirar la casa por la ventana", "estar en las nubes", "no tener pelos en la lengua",
      "ser uña y carne", "hacer la vista gorda", "meter la pata",
      "buscarle la quinta pata al gato", "el que madruga, Dios le ayuda",
      "la curiosidad mató al gato", "más vale pájaro en mano que ciento volando",
      "no pegar ojo", "irse por las ramas", "montar un pollo",
    ];

    const interjections = ["¡Vaya!", "¡Ojo!", "Bueno...", "Pues mira...", "¿Sabes?", "¿Me sigues?", "Anda,", "En fin,"];

    const formalToInformal = {
      "implementar": "usar", "optimizar": "mejorar", "paradigma": "enfoque",
      "sinergia": "colaboración", "efectuar": "hacer", "procedimiento": "paso",
      "facilitar": "ayudar", "consecuentemente": "por eso", "no obstante": "pero",
      "por consiguiente": "así que", "en consecuencia": "por lo tanto",
      "utilizar": "usar", "visualizar": "ver", "finalizar": "terminar",
      "acelerar": "agilizar", "mitigar": "reducir", "viable": "posible",
      "demostrar": "mostrar", "evaluar": "analizar", "estrategia": "plan",
    };

    const synonyms = {
      "crear": ["generar", "hacer", "producir", "elaborar"],
      "analizar": ["estudiar", "revisar", "examinar", "inspeccionar"],
      "importante": ["clave", "fundamental", "esencial", "crítico"],
      "rápido": ["veloz", "ágil", "pronto", "inmediato"],
      "difícil": ["complicado", "duro", "arduo", "engorroso"],
    };

    // --- Funciones auxiliares ---
    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function cleanText(text) {
      return text
        .replace(/[\u200B-\u200D\uFEFF]/g, '')
        .replace(/[\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/g, ' ')
        .replace(/[\r]{3,}/g, '')
        .replace(/[ \t]+/g, ' ')
        .replace(/ +([,.!?¿¡:]+)/g, '$1')
        .replace(/([¿¡]) +/g, '$1')
        .trim();
    }

    function wordCount(text) {
      return text.trim() ? text.trim().split(/\s+/).length : 0;
    }

    function readability(text) {
      const sentences = (text.match(/[.!?]+/g) || []).length || 1;
      const words = wordCount(text);
      const syllables = text.split(/[aeiouáéíóú]/i).length;
      const asl = words / sentences;
      const asw = syllables / words;
      const flesch = 206.835 - (1.015 * asl) - (84.6 * asw);
      return Math.max(0, Math.min(100, flesch / 2));
    }

    function calculateAIScore(text) {
      const patterns = [
        /(?:además|por otro lado|en conclusión)/g,
        /\b(?:optimizar|implementar|paradigma|sinergia)\b/g,
        /(?:es importante destacar que|vale la pena mencionar que)/g,
        /(?:en el contexto actual|en la actualidad)/g,
      ];
      const aiIndicators = patterns.reduce((sum, pattern) => sum + (text.match(pattern)?.length || 0), 0);
      const wordCount = text.split(/\s+/).length;
      const aiScore = (aiIndicators / (wordCount / 100)) * 30;
      return Math.min(100, Math.max(0, aiScore));
    }

    // --- Almacenamiento Local ---
    function saveState() {
      try {
        localStorage.setItem('redactaproSupremoState', JSON.stringify(state));
      } catch (e) {
        console.warn("No se pudo guardar el estado:", e);
      }
    }

    function loadState() {
      const savedState = localStorage.getItem('redactaproSupremoState');
      if (savedState) {
        try {
          const parsed = JSON.parse(savedState);
          Object.assign(state, parsed);
          document.getElementById('input-text').value = state.inputText;
          if (state.history) {
            renderHistory();
          }
          // Restaurar configuración
          if (parsed.settings) {
            Object.keys(parsed.settings).forEach(key => {
              const el = document.getElementById(`setting-${key}`);
              if (el) el.checked = parsed.settings[key];
            });
            document.getElementById('setting-depth').value = parsed.settings.depth || 'suave';
          }
          // Restaurar pestaña
          if (state.activeTab) {
            setActiveTab(state.activeTab);
          }
        } catch (e) {
          console.error("Error al cargar el estado:", e);
        }
      }
    }

    // --- Procesamiento del texto ---
    async function processText() {
      const inputEl = document.getElementById('input-text');
      state.inputText = inputEl.value.trim();

      if (!state.inputText) {
        alert("Por favor, introduce un texto.");
        return;
      }

      state.isProcessing = true;
      setActiveTab('analyze');
      updateProgress(0, "Iniciando...");

      // Simular pasos
      await sleep(200);
      updateProgress(20, "Limpieza inicial...");
      await sleep(200);

      let processed = cleanText(state.inputText);

      updateProgress(40, "Aplicando variación...");
      processed = introduceVariety(processed);

      updateProgress(60, "Añadiendo naturalidad...");
      if (Math.random() > 0.5) {
        const idiom = getRandom(humanIdioms);
        const sentences = processed.split(/(?<=[.!?])\s+/);
        const insertAt = Math.floor(Math.random() * sentences.length);
        sentences[insertAt] = sentences[insertAt] + " —" + idiom + "—";
        processed = sentences.join(' ');
      }

      updateProgress(80, "Ajustando tono...");
      await sleep(200);

      updateProgress(100, "¡Listo!");
      state.outputText = processed;
      state.analysisScore = 100 - calculateAIScore(processed);

      // Guardar en historial
      addToHistory();
      saveState();

      // Actualizar UI final
      setTimeout(() => {
        setActiveTab('review');
        updateReviewUI();
      }, 300);
    }

    function introduceVariety(text) {
      let sentences = text.split(/(?<=[.!?])\s+/);

      const settings = getSettings();

      if (settings.connectorVariety && Math.random() > 0.6) {
        const connector = getRandom(connectors);
        sentences[0] = connector + " " + sentences[0].charAt(0).toLowerCase() + sentences[0].slice(1);
      }

      if (settings.naturalFlow && Math.random() > 0.7) {
        const interjection = getRandom(interjections);
        const idx = Math.floor(Math.random() * sentences.length);
        sentences[idx] = interjection + " " + sentences[idx];
      }

      if (settings.lexicalRichness) {
        sentences = sentences.map(sentence => {
          Object.keys(synonyms).forEach(word => {
            const regex = new RegExp(`\\b${word}\\b`, 'gi');
            sentence = sentence.replace(regex, () => getRandom(synonyms[word]));
          });
          return sentence;
        });
      }

      if (settings.toneAdjustment) {
        sentences = sentences.map(sentence => {
          Object.keys(formalToInformal).forEach(formal => {
            const regex = new RegExp(`\\b${formal}\\b`, 'gi');
            sentence = sentence.replace(regex, formalToInformal[formal]);
          });
          return sentence;
        });
      }

      return sentences.join(' ');
    }

    function getSettings() {
      const settings = {};
      document.querySelectorAll('input[id^="setting-"]').forEach(el => {
        settings[el.id.replace('setting-', '')] = el.checked;
      });
      settings.depth = document.getElementById('setting-depth').value;
      return settings;
    }

    function updateProgress(percent, message) {
      state.progress = percent;
      state.progressMessage = message;
      document.getElementById('progress-bar').style.width = `${percent}%`;
      document.getElementById('progress-message').textContent = message;
      document.getElementById('progress-percent').textContent = `${percent}% completado`;
      document.getElementById('output-analysis').textContent = state.outputText || 'Procesando...';
    }

    function updateReviewUI() {
      document.getElementById('output-review').textContent = state.outputText;
      document.getElementById('analysis-score').textContent = state.analysisScore.toFixed(1) + '%';
      document.getElementById('score-bar').style.width = `${state.analysisScore}%`;
      document.getElementById('word-count-original').textContent = wordCount(state.inputText);
      document.getElementById('word-count-final').textContent = wordCount(state.outputText);
      document.getElementById('readability-score').textContent = readability(state.outputText).toFixed(1) + '%';

      const msg = document.getElementById('score-message');
      if (state.analysisScore > 70) {
        msg.textContent = "Texto altamente humano. Baja probabilidad de detección.";
      } else if (state.analysisScore > 50) {
        msg.textContent = "Texto razonablemente humano. Algunos ajustes podrían ayudar.";
      } else {
        msg.textContent = "Alta probabilidad de ser detectado como IA. Considera ajustes más profundos.";
      }
    }

    function addToHistory() {
      const item = {
        original: state.inputText.substring(0, 100) + (state.inputText.length > 100 ? '...' : ''),
        result: state.outputText.substring(0, 100) + (state.outputText.length > 100 ? '...' : ''),
        score: state.analysisScore,
        date: new Date().toLocaleDateString(),
      };
      state.history.unshift(item);
      state.history = state.history.slice(0, 7);
      renderHistory();
    }

    function renderHistory() {
      const container = document.getElementById('history-container');
      if (state.history.length === 0) {
        container.innerHTML = '<p class="text-sm text-slate-400">No hay historial aún</p>';
        return;
      }
      container.innerHTML = state.history.map(item => `
        <div onclick="loadFromHistory('${escapeHtml(item.original)}', '${escapeHtml(item.result)}', ${item.score})" class="p-3 bg-slate-800/30 rounded-lg cursor-pointer hover:bg-slate-700/30 transition-colors text-sm">
          <p class="text-slate-200 line-clamp-1">${item.original}</p>
          <p class="text-xs text-teal-400 mt-1">Puntuación: ${item.score.toFixed(1)}%</p>
        </div>
      `).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function loadFromHistory(original, result, score) {
      document.getElementById('input-text').value = original;
      state.outputText = result;
      state.analysisScore = score;
      setActiveTab('review');
      updateReviewUI();
    }

    function copyToClipboard() {
      if (!state.outputText) return;
      navigator.clipboard.writeText(state.outputText).then(() => {
        const toast = document.getElementById('toast');
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 2000);
      });
    }

    function downloadText(format) {
      if (!state.outputText) return;
      const timestamp = new Date().toISOString().split('T')[0];
      let blob, filename;

      if (format === 'txt') {
        blob = new Blob([state.outputText], { type: 'text/plain;charset=utf-8' });
        filename = `redactapro-supremo-${timestamp}.txt`;
      } else if (format === 'doc') {
        const htmlContent = `
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="UTF-8">
            <title>Texto Humanizado - RedactaPro Supremo</title>
            <style>body { font-family: 'Inter', sans-serif; line-height: 1.7; color: #333; }</style>
          </head>
          <body>
            <p>${state.outputText.replace(/\n/g, '<br>')}</p>
          </body>
          </html>`;
        blob = new Blob([htmlContent], { type: 'application/msword;charset=utf-8' });
        filename = `redactapro-supremo-${timestamp}.doc`;
      }

      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function setActiveTab(tab) {
      // Ocultar todas las secciones
      document.getElementById('write-section').classList.add('hidden');
      document.getElementById('analyze-section').classList.add('hidden');
      document.getElementById('review-section').classList.add('hidden');

      // Mostrar la seleccionada
      document.getElementById(`${tab}-section`).classList.remove('hidden');

      // Actualizar botones
      ['write', 'analyze', 'review'].forEach(t => {
        const btn = document.getElementById(`tab-${t}`);
        btn.classList.remove('bg-teal-500', 'text-white');
        btn.classList.add('text-slate-400');
        if (t === tab) {
          btn.classList.remove('text-slate-400');
          btn.classList.add('bg-teal-500', 'text-white');
        }
      });

      // Guardar pestaña actual
      state.activeTab = tab;
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // --- Inicialización ---
    document.addEventListener('DOMContentLoaded', () => {
      loadState(); // Cargar estado guardado
      renderHistory();
    });

    // Guardar configuración al cambiar
    document.addEventListener('change', () => {
      saveState();
    });

    window.addEventListener('beforeunload', () => {
      saveState();
    });
  </script>
</body>
</html>
