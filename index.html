<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RedactaPro Supremo - Motor de Humanización</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx@7.11.0/build/index.browser.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/cdn/lucide.min.js"></script>
    <style>
        :root {
            --bg: #ffffff;
            --bg-sidebar: #f8f9fa;
            --text: #1f2937;
            --text-secondary: #4b5563;
            --accent: #1d4ed8;
            --accent-light: #3b82f6;
            --border: #e5e7eb;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --safe: #10b981;
            --caution: #f59e0b;
            --risk: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
            position: fixed;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-section {
            margin-bottom: 25px;
        }

        .tool-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tool-btn {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 6px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Main content */
        .main-content {
            margin-left: 300px;
            padding: 30px;
            width: calc(100% - 300px);
        }

        h1 {
            color: var(--accent);
            margin: 0 0 10px 0;
            font-weight: 700;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        p.subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 25px;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: white;
            color: var(--text);
            font-size: 1rem;
            resize: vertical;
            font-family: 'Inter', sans-serif;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        /* Buttons */
        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            margin-right: 10px;
            margin-bottom: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--accent-light);
        }

        .btn-secondary {
            background: white;
            color: var(--text);
            border: 1px solid var(--border);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: #f1f5f9;
        }

        /* Evasion Panel */
        .evasion-panel {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .evasion-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 6px 0;
            border-bottom: 1px dashed #e2e8f0;
        }

        .evasion-status {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--safe);
        }

        .status-caution { background: var(--caution); }
        .status-risk { background: var(--risk); }

        /* Output */
        .output {
            margin-top: 20px;
        }

        /* Status bar */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #f1f5f9;
            border-top: 1px solid var(--border);
            padding: 8px 30px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            z-index: 100;
            align-items: center;
        }

        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg);
            color: var(--text);
            padding: 12px 24px;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i data-lucide="shield-check"></i>
            RedactaPro Supremo
        </div>

        <div class="tool-section">
            <div class="tool-title">
                <i data-lucide="settings"></i>
                Estilo
            </div>
            <button class="tool-btn" onclick="setEstilo('colloquial')">
                <i data-lucide="message-circle"></i>
                Coloquial
            </button>
            <button class="tool-btn" onclick="setEstilo('formal')">
                <i data-lucide="book"></i>
                Formal
            </button>
            <button class="tool-btn" onclick="setEstilo('tecnico')">
                <i data-lucide="code"></i>
                Técnico
            </button>
        </div>

        <div class="tool-section">
            <div class="tool-title">
                <i data-lucide="shield"></i>
                Evasión
            </div>
            <button class="tool-btn" onclick="analizarEvasion()">
                <i data-lucide="activity"></i>
                Analizar Evasión
            </button>
            <button class="tool-btn" onclick="detectarTonoRobótico()">
                <i data-lucide="alert-triangle"></i>
                Detectar IA
            </button>
            <button class="tool-btn" onclick="copiarConFormato()">
                <i data-lucide="copy"></i>
                Copiar para Docs
            </button>
        </div>

        <div class="tool-section">
            <div class="tool-title">
                <i data-lucide="download"></i>
                Exportar
            </div>
            <button class="tool-btn" onclick="exportarPDF()">
                <i data-lucide="file-text"></i>
                Exportar PDF
            </button>
            <button class="tool-btn" onclick="exportarDOCX()">
                <i data-lucide="file-word"></i>
                Exportar Word
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <h1>
            <i data-lucide="shield-check"></i>
            Motor de Humanización Avanzada
        </h1>
        <p class="subtitle">Evasión total, redacción natural, estilo personal</p>

        <div class="form-group">
            <label for="input">
                <i data-lucide="file-input"></i>
                Texto Original
            </label>
            <textarea id="input" placeholder="Pega tu texto aquí..."></textarea>
        </div>

        <div>
            <button class="btn" onclick="humanizar()">
                <i data-lucide="sparkles"></i>
                Humanizar Texto
            </button>
            <button class="btn btn-secondary" onclick="limpiar()">
                <i data-lucide="trash-2"></i>
                Limpiar
            </button>
        </div>

        <!-- Evasion Panel -->
        <div class="evasion-panel" id="evasionPanel">
            <strong>🛡️ Análisis de Evasión:</strong>
            <div class="evasion-item">
                <span>Tono robótico</span>
                <div class="evasion-status">
                    <span class="status-dot" id="roboticStatus"></span>
                    <span id="roboticText">Bajo</span>
                </div>
            </div>
            <div class="evasion-item">
                <span>Patrones de IA</span>
                <div class="evasion-status">
                    <span class="status-dot" id="patternStatus"></span>
                    <span id="patternText">Bajo</span>
                </div>
            </div>
            <div class="evasion-item">
                <span>Entropía textual</span>
                <div class="evasion-status">
                    <span class="status-dot" id="entropyStatus"></span>
                    <span id="entropyText">Alta</span>
                </div>
            </div>
            <div class="evasion-item">
                <span>Veredicto final</span>
                <div class="evasion-status">
                    <span class="status-dot" id="finalStatus"></span>
                    <span id="finalText">✅ Pasa detectores</span>
                </div>
            </div>
        </div>

        <!-- Output -->
        <div class="output">
            <label for="output">
                <i data-lucide="file-output"></i>
                Texto Humanizado
            </label>
            <textarea id="output" readonly placeholder="Aquí aparecerá el resultado..."></textarea>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-item">
            <i data-lucide="shield-check"></i>
            <span>Evasión activa</span>
        </div>
        <div class="status-item">
            <i data-lucide="type"></i>
            <span id="status-estilo">Estilo: Coloquial</span>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i data-lucide="check-circle"></i>
        <span id="toast-message">¡Listo!</span>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx@7.11.0/build/index.browser.js"></script>
    <script>
        // Inicializar Lucide
        lucide.createIcons();

        // Estado
        let textoFinal = '';
        let estiloActual = 'colloquial';
        const historialKey = 'rps_historial_v19';

        // Sinónimos contextuales
        const sinonimos = {
            'importante': ['clave', 'fundamental', 'esencial'],
            'destacar': ['resaltar', 'enfatizar', 'señalar'],
            'contexto': ['marco', 'escenario', 'situación'],
            'por lo tanto': ['entonces', 'así que', 'por eso'],
            'como resultado': ['por ende', 'en consecuencia', 'de ahí que'],
            'en conclusión': ['para cerrar', 'finalmente', 'en definitiva']
        };

        // Muletillas naturales
        const muletillas = [
            'la verdad,', 'ahora...', 'fijate que', 'para que entiendas...',
            'básicamente,', 'vamos a ver...', 'en esta unidad...', 'ya sabés, el sistema'
        ];

        // Configuración de estilo
        function setEstilo(estilo) {
            estiloActual = estilo;
            document.getElementById('status-estilo').textContent = `Estilo: ${{
                colloquial: 'Coloquial',
                formal: 'Formal',
                tecnico: 'Técnico'
            }[estilo]}`;
            mostrarToast(`Estilo: ${estilo}`);
        }

        // Humanizar texto
        function humanizar() {
            const input = document.getElementById('input').value.trim();
            if (!input) {
                alert('Pega un texto primero');
                return;
            }

            let lines = input.split('\n').map(l => l.trim()).filter(l => l);
            let result = [];

            // Intro natural
            const intros = {
                colloquial: 'Ahora...',
                formal: 'En esta unidad:',
                tecnico: 'Análisis:'
            };
            result.push(`${intros[estiloActual]} ${lines[0]}.`);
            result.push('');

            let seen = new Set();
            let fillerAdded = false;

            for (let i = 1; i < lines.length; i++) {
                let line = lines[i];
                if (seen.has(line.toLowerCase())) continue;
                seen.add(line.toLowerCase());

                // Añadir muletilla en democracia
                if (!fillerAdded && line.toLowerCase().startsWith('democracia:') && line.includes(':')) {
                    const parts = line.split(':');
                    const value = parts[1].trim();
                    if (value.length > 10) {
                        line = `${parts[0]}: la verdad, ${value.charAt(0).toLowerCase() + value.slice(1)}`;
                        fillerAdded = true;
                    }
                }

                // Reemplazar con sinónimos
                if (estiloActual !== 'formal') {
                    for (const [palabra, lista] of Object.entries(sinonimos)) {
                        const regex = new RegExp(palabra, 'gi');
                        if (line.match(regex)) {
                            const sinonimo = lista[Math.floor(Math.random() * lista.length)];
                            line = line.replace(regex, sinonimo);
                        }
                    }
                }

                // Saltos después de ":"
                if (line.endsWith(':')) {
                    result.push(line);
                    result.push('');
                } else {
                    result.push(line);
                }
            }

            // Frase final
            const endings = [
                'Para que entiendas... ya sabés, el sistema.',
                'O sea... para que suene 100% real.',
                'Este... para que puedas usarlo siempre.'
            ];
            result.push('');
            result.push(endings[Math.floor(Math.random() * endings.length)]);
            result.push('');
            result.push('Tu éxito es mi mayor motivación, mi vida 💖');

            textoFinal = result.join('\n');
            document.getElementById('output').value = textoFinal;
            analizarEvasion();
            mostrarToast('✅ Texto humanizado');
        }

        // Analizar evasión
        function analizarEvasion() {
            const input = document.getElementById('output').value.trim();
            if (!input) return;

            const tieneIA = /es importante destacar|en este contexto|a continuación/i.test(input.toLowerCase());
            const tieneMuletilla = muletillas.some(m => input.toLowerCase().includes(m));
            const tieneSalto = (input.match(/:\s*\n/g) || []).length > 2;

            // Tono robótico
            setDot('roboticStatus', tieneIA ? 'risk' : 'safe');
            document.getElementById('roboticText').textContent = tieneIA ? 'Alto' : 'Bajo';

            // Patrones de IA
            setDot('patternStatus', tieneIA ? 'risk' : 'safe');
            document.getElementById('patternText').textContent = tieneIA ? 'Detectado' : 'No detectado';

            // Entropía
            const entropia = tieneMuletilla && tieneSalto ? 'safe' : 'caution';
            setDot('entropyStatus', entropia);
            document.getElementById('entropyText').textContent = entropia === 'safe' ? 'Alta' : 'Media';

            // Veredicto
            if (tieneIA) {
                setDot('finalStatus', 'risk');
                document.getElementById('finalText').textContent = '❌ No pasa detectores';
            } else if (tieneMuletilla && tieneSalto) {
                setDot('finalStatus', 'safe');
                document.getElementById('finalText').textContent = '✅ Pasa detectores';
            } else {
                setDot('finalStatus', 'caution');
                document.getElementById('finalText').textContent = '⚠️ Podría mejorar';
            }

            document.getElementById('evasionPanel').style.display = 'block';
        }

        // Detectar tono robótico
        function detectarTonoRobótico() {
            const input = document.getElementById('input').value.trim();
            if (!input) return;
            const detector = document.getElementById('detector-result');
            const tieneIA = /es importante destacar|en este contexto|a continuación/i.test(input.toLowerCase());
            detector.innerHTML = tieneIA 
                ? '<p style="color:#EF4444;">⚠️ Frases robóticas detectadas. Usa "Humanizar".</p>' 
                : '<p style="color:#10B981;">✅ No se detectaron frases robóticas.</p>';
            detector.style.display = 'block';
        }

        // Copiar con formato para Google Docs
        function copiarConFormato() {
            const out = document.getElementById('output');
            if (!out.value) return;
            out.select();
            document.execCommand('copy');
            mostrarToast('📋 Copiado (listo para Docs)');
        }

        // Exportar PDF
        function exportarPDF() {
            if (!textoFinal) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(12);
            const lines = doc.splitTextToSize(textoFinal, 180);
            doc.text(lines, 15, 20);
            doc.save('redactapro-supremo.pdf');
        }

        // Exportar DOCX
        function exportarDOCX() {
            if (!textoFinal) return;
            const { Document, Packer, Paragraph, TextRun } = window.docx;
            const doc = new Document({
                sections: [{
                    properties: {},
                    children: [
                        new Paragraph({
                            children: [
                                new TextRun(textoFinal)
                            ]
                        })
                    ]
                }]
            });
            Packer.toBlob(doc).then(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'redactapro-supremo.docx';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }

        // Limpiar
        function limpiar() {
            document.getElementById('input').value = '';
            document.getElementById('output').value = '';
            document.getElementById('evasionPanel').style.display = 'none';
        }

        // Mostrar toast
        function mostrarToast(msg) {
            const t = document.getElementById('toast');
            const span = document.getElementById('toast-message');
            span.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        // Helper para puntos de estado
        function setDot(id, type) {
            const dot = document.getElementById(id);
            dot.className = 'status-dot';
            if (type === 'caution') dot.classList.add('status-caution');
            if (type === 'risk') dot.classList.add('status-risk');
        }
    </script>
</body>
</html>
